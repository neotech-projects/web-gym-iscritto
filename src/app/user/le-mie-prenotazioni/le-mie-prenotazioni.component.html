<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">Le Mie Prenotazioni</h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a routerLink="/dashboard">Home</a></li>
                    <li class="breadcrumb-item active">Le Mie Prenotazioni</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex align-items-center">
                    <h5 class="card-title mb-0 flex-grow-1">Storico Prenotazioni</h5>
                    <div class="flex-shrink-0">
                        <button type="button" class="btn btn-soft-primary btn-sm" (click)="filterBookings('all')" [class.active]="currentFilter === 'all'">Tutte</button>
                        <button type="button" class="btn btn-soft-success btn-sm" (click)="filterBookings('future')" [class.active]="currentFilter === 'future'">Future</button>
                        <button type="button" class="btn btn-soft-secondary btn-sm" (click)="filterBookings('past')" [class.active]="currentFilter === 'past'">Passate</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!-- Tabella Desktop -->
                <div class="table-responsive d-lg-block d-none">
                    <table class="table table-bordered table-nowrap align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Data</th>
                                <th scope="col">Orario</th>
                                <th scope="col">Durata</th>
                                <th scope="col">Stato</th>
                                <th scope="col">Azioni</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let booking of filteredBookings">
                                <td>{{ formatDate(booking.data) }}</td>
                                <td>{{ booking.oraInizio }} - {{ booking.oraFine }}</td>
                                <td>{{ calculateDuration(booking.oraInizio, booking.oraFine) }}</td>
                                <td>
                                    <span *ngIf="isFuture(booking)" class="badge bg-success-subtle text-success">Confermata</span>
                                    <span *ngIf="!isFuture(booking)" class="badge bg-secondary-subtle text-secondary">Completata</span>
                                </td>
                                <td>
                                    <button *ngIf="isFuture(booking)" 
                                            class="btn btn-sm btn-soft-danger" 
                                            (click)="cancelBooking(booking.id)">
                                        <i class="ri-close-line"></i> Cancella
                                    </button>
                                    <span *ngIf="!isFuture(booking)" class="text-muted">â€”</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Accordion Mobile e Tablet -->
                <div id="bookingsAccordion" class="d-lg-none mt-3">
                    <div *ngFor="let booking of filteredBookings; let i = index" class="booking-accordion-item">
                        <button class="booking-accordion-header" 
                                type="button" 
                                (click)="toggleAccordion('booking' + booking.id)"
                                [attr.aria-expanded]="getAccordionState('booking' + booking.id)"
                                [attr.aria-controls]="'booking' + booking.id">
                            <div>
                                <div class="fw-semibold">{{ formatDate(booking.data) }}</div>
                                <div class="text-muted small">{{ booking.oraInizio }} - {{ booking.oraFine }}</div>
                            </div>
                            <div>
                                <span *ngIf="isFuture(booking)" class="badge bg-success-subtle text-success">Confermata</span>
                                <span *ngIf="!isFuture(booking)" class="badge bg-secondary-subtle text-secondary">Completata</span>
                            </div>
                        </button>
                        <div [id]="'booking' + booking.id" 
                             class="collapse" 
                             [class.show]="isAccordionOpen('booking' + booking.id)">
                            <div class="booking-accordion-body">
                                <div class="booking-info-row">
                                    <span class="booking-info-label">Data</span>
                                    <span class="booking-info-value">{{ formatDate(booking.data) }}</span>
                                </div>
                                <div class="booking-info-row">
                                    <span class="booking-info-label">Orario</span>
                                    <span class="booking-info-value">{{ booking.oraInizio }} - {{ booking.oraFine }}</span>
                                </div>
                                <div class="booking-info-row">
                                    <span class="booking-info-label">Durata</span>
                                    <span class="booking-info-value">{{ calculateDuration(booking.oraInizio, booking.oraFine) }}</span>
                                </div>
                                <div class="booking-info-row">
                                    <span class="booking-info-label">Stato</span>
                                    <span class="booking-info-value">
                                        <span *ngIf="isFuture(booking)" class="badge bg-success-subtle text-success">Confermata</span>
                                        <span *ngIf="!isFuture(booking)" class="badge bg-secondary-subtle text-secondary">Completata</span>
                                    </span>
                                </div>
                                <button *ngIf="isFuture(booking)" 
                                        class="btn btn-sm btn-danger w-100 mt-3" 
                                        (click)="cancelBooking(booking.id)">
                                    <i class="ri-close-line"></i> Cancella Prenotazione
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Messaggio nessuna prenotazione -->
                <div class="text-center mt-3" *ngIf="filteredBookings.length === 0">
                    <div class="py-4">
                        <i class="ri-calendar-line display-4 text-muted"></i>
                        <h5 class="mt-3">Nessuna prenotazione trovata</h5>
                        <p class="text-muted">Non ci sono prenotazioni da visualizzare.</p>
                        <a routerLink="/dashboard/prenota" class="btn btn-primary">Crea una Prenotazione</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
