<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">Prenota</h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a routerLink="/dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item active">Prenota</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- Card "Prenota!" visibile solo su mobile, sopra il calendario -->
<div class="row mb-3 d-xl-none">
    <div class="col-12">
        <div class="card">
            <div class="card-body bg-success-subtle">
                <div class="d-flex">
                    <div class="flex-shrink-0">
                        <i class="ri-calendar-check-line text-success display-6"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="fs-16">Prenota!</h6>
                        <p class="text-muted mb-0">Seleziona data e ora nel calendario. La palestra può ospitare massimo 10 persone contemporaneamente.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-9">
        <div class="card card-h-100">
            <div class="card-body p-2 p-md-3">
                <div id="calendar" class="calendar-wrapper"></div>
            </div>
        </div>
    </div>

    <div class="col-xl-3">
        <!-- Card "Prenota!" visibile solo su desktop, nella sidebar -->
        <div class="card d-none d-xl-block">
            <div class="card-body bg-success-subtle">
                <div class="d-flex">
                    <div class="flex-shrink-0">
                        <i class="ri-calendar-check-line text-success display-6"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="fs-16">Prenota!</h6>
                        <p class="text-muted mb-0">Seleziona data e ora nel calendario. La palestra può ospitare massimo 10 persone contemporaneamente.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Legenda</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6 class="fs-14 mb-2">Disponibilità Palestra:</h6>
                    <div class="d-flex align-items-center mb-2">
                        <span class="me-2" style="width: 30px; height: 20px; background-color: #0ab39c; display: inline-block; border-radius: 3px;"></span>
                        <span>Disponibile</span>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                        <span class="me-2" style="width: 30px; height: 20px; background-color: #f7b84b; display: inline-block; border-radius: 3px;"></span>
                        <span>Parzialmente Occupato</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <span class="me-2" style="width: 30px; height: 20px; background-color: #f06548; display: inline-block; border-radius: 3px;"></span>
                        <span>Occupato</span>
                    </div>
                </div>
                <hr class="my-3">
                <div>
                    <h6 class="fs-14 mb-2">Tue Prenotazioni:</h6>
                    <div class="d-flex align-items-center">
                        <span class="me-2" style="width: 30px; height: 20px; background-color: #405189; display: inline-block; border-radius: 3px;"></span>
                        <span>Le Tue Prenotazioni</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Visualizza Dettagli Prenotazione -->
<div class="modal fade" id="viewBookingModal" tabindex="-1" aria-labelledby="viewBookingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary-subtle">
                <h5 class="modal-title" id="viewBookingModalLabel">Dettagli Prenotazione</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Data</label>
                    <input type="date" class="form-control" id="viewBookingDate" disabled>
                </div>
                <div class="row mb-3">
                    <div class="col-6">
                        <label class="form-label fw-semibold">Ora Inizio</label>
                        <input type="time" class="form-control" id="viewBookingStartTime" disabled>
                    </div>
                    <div class="col-6">
                        <label class="form-label fw-semibold">Ora Fine</label>
                        <input type="time" class="form-control" id="viewBookingEndTime" disabled>
                    </div>
                </div>
                <div class="alert alert-info" role="alert">
                    <i class="ri-information-line me-2"></i>
                    <strong>Durata:</strong> <span id="viewDuration"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-soft-secondary" data-bs-dismiss="modal">Chiudi</button>
                <button type="button" class="btn btn-danger" (click)="deleteCurrentBooking()">
                    <i class="ri-delete-bin-line me-1"></i> Cancella Prenotazione
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Prenotazione -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-success-subtle">
                <h5 class="modal-title" id="bookingModalLabel">Nuova Prenotazione</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Sezione Disponibilità Orari (visibile solo dalla vista mensile) -->
                <div id="dayAvailabilitySection" style="display: none;">
                    <h6 class="mb-3" id="selectedDayTitle"></h6>
                    <div class="table-responsive mb-4">
                        <table class="table table-sm table-bordered align-middle" id="dayAvailabilityTable">
                            <thead>
                                <tr>
                                    <th>Orario</th>
                                    <th>Disponibilità</th>
                                    <th>Stato</th>
                                    <th>Azione</th>
                                </tr>
                            </thead>
                            <tbody id="dayAvailabilityTableBody">
                                <!-- Gli orari verranno inseriti qui -->
                            </tbody>
                        </table>
                    </div>
                    <hr class="my-4">
                    <h6 class="mb-3">Oppure scegli un orario personalizzato:</h6>
                </div>
                
                <!-- Alert Disponibilità (mostrato quando si seleziona un orario) -->
                <div id="availabilityInfo" class="alert mb-3" role="alert" style="display: none;">
                    <i class="ri-group-line me-2"></i>
                    <strong>Disponibilità attuale:</strong> <span id="availabilityText"></span>
                </div>
                
                <form [formGroup]="bookingForm" id="bookingForm">
                    <div class="mb-3">
                        <label for="bookingDate" class="form-label">Data</label>
                        <input type="date" class="form-control" id="bookingDate" formControlName="date" required>
                        <small class="text-muted">Non è possibile prenotare per giorni passati</small>
                    </div>
                    <div class="row mb-3">
                        <div class="col-6">
                            <label for="bookingStartTime" class="form-label">Ora Inizio</label>
                            <input type="time" class="form-control" id="bookingStartTime" formControlName="startTime" required>
                        </div>
                        <div class="col-6">
                            <label for="bookingEndTime" class="form-label">Ora Fine</label>
                            <input type="time" class="form-control" id="bookingEndTime" formControlName="endTime" required>
                        </div>
                    </div>
                    <div class="alert alert-info" role="alert">
                        <i class="ri-information-line me-2"></i>
                        <strong>Nota:</strong> La prenotazione ha una durata minima di 30 minuti e massima di 2 ore.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-soft-secondary" data-bs-dismiss="modal">Annulla</button>
                <button type="button" class="btn btn-success" (click)="confirmBooking()">Conferma Prenotazione</button>
            </div>
        </div>
    </div>
</div>
