<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">La Mia Dashboard</h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a routerLink="/dashboard">Home</a></li>
                    <li class="breadcrumb-item active">Dashboard</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-6 col-md-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Prenotazioni</p>
                    </div>
                    <div class="flex-shrink-0">
                        <h5 class="text-info fs-14 mb-0">
                            <i class="ri-arrow-up-line fs-13 align-middle"></i> +2
                        </h5>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-4">
                    <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4">{{ bookingsCount }}</h4>
                        <a routerLink="/prenota" class="btn btn-soft-info btn-sm mt-2">Prenota</a>
                    </div>
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-info-subtle rounded fs-3">
                            <i class="ri-calendar-check-line text-info"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-6 col-md-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Allenamenti</p>
                    </div>
                    <div class="flex-shrink-0">
                        <h5 class="text-warning fs-14 mb-0">
                            <i class="ri-arrow-up-line fs-13 align-middle"></i> +2
                        </h5>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-4">
                    <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4">{{ workoutsCount }}</h4>
                        <a routerLink="/le-mie-prenotazioni" class="text-decoration-underline text-muted mb-0" style="cursor: pointer;">Questo mese</a>
                    </div>
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-warning-subtle rounded fs-3">
                            <i class="ri-run-line text-warning"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-12">
        <div class="card">
            <div class="card-header align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Le Mie Prossime Prenotazioni</h4>
                <div class="flex-shrink-0">
                    <a routerLink="/le-mie-prenotazioni" class="btn btn-soft-info btn-sm">Vedi tutte</a>
                </div>
            </div>
            <div class="card-body">
                <!-- Tabella Desktop -->
                <div class="table-responsive table-card d-lg-block d-none">
                    <table class="table table-borderless table-hover table-nowrap align-middle mb-0">
                        <thead>
                            <tr>
                                <th scope="col">Data</th>
                                <th scope="col">Orario</th>
                                <th scope="col">Durata</th>
                                <th scope="col">Stato</th>
                                <th scope="col">Azioni</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let prenotazione of prossimePrenotazioni">
                                <td>{{ formatData(prenotazione.data) }}</td>
                                <td>{{ prenotazione.oraInizio }} - {{ prenotazione.oraFine }}</td>
                                <td>{{ prenotazione.durata }}</td>
                                <td><span class="badge bg-success-subtle text-success">{{ prenotazione.stato }}</span></td>
                                <td>
                                    <button type="button" 
                                            class="btn btn-sm btn-soft-danger"
                                            (click)="annullaPrenotazione(prenotazione.id)">
                                        Annulla
                                    </button>
                                </td>
                            </tr>
                            <tr *ngIf="prossimePrenotazioni.length === 0">
                                <td colspan="5" class="text-center">Nessuna prenotazione trovata</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Accordion Mobile e Tablet -->
                <div id="dashboardBookingsAccordion" class="d-lg-none">
                    <div *ngFor="let prenotazione of prossimePrenotazioni; let i = index" class="booking-accordion-item">
                        <button class="booking-accordion-header" 
                                type="button" 
                                (click)="toggleAccordion('dashboardBooking' + prenotazione.id)"
                                [attr.aria-expanded]="getAccordionState('dashboardBooking' + prenotazione.id)"
                                [attr.aria-controls]="'dashboardBooking' + prenotazione.id">
                            <div>
                                <div class="fw-semibold">{{ formatData(prenotazione.data) }}</div>
                                <div class="text-muted small">{{ prenotazione.oraInizio }} - {{ prenotazione.oraFine }}</div>
                            </div>
                            <div>
                                <span class="badge bg-success-subtle text-success">{{ prenotazione.stato }}</span>
                            </div>
                        </button>
                        <div [id]="'dashboardBooking' + prenotazione.id" 
                             class="collapse"
                             [class.show]="getAccordionState('dashboardBooking' + prenotazione.id) === 'true'">
                            <div class="booking-accordion-body">
                                <div class="booking-info-row">
                                    <span class="booking-info-label">Data</span>
                                    <span class="booking-info-value">{{ formatData(prenotazione.data) }}</span>
                                </div>
                                <div class="booking-info-row">
                                    <span class="booking-info-label">Orario</span>
                                    <span class="booking-info-value">{{ prenotazione.oraInizio }} - {{ prenotazione.oraFine }}</span>
                                </div>
                                <div class="booking-info-row">
                                    <span class="booking-info-label">Durata</span>
                                    <span class="booking-info-value">{{ prenotazione.durata }}</span>
                                </div>
                                <div class="booking-info-row">
                                    <span class="booking-info-label">Stato</span>
                                    <span class="booking-info-value">
                                        <span class="badge bg-success-subtle text-success">{{ prenotazione.stato }}</span>
                                    </span>
                                </div>
                                <button type="button" 
                                        class="btn btn-sm btn-danger w-100 mt-3" 
                                        (click)="annullaPrenotazione(prenotazione.id)">
                                    <i class="ri-close-line"></i> Annulla Prenotazione
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="prossimePrenotazioni.length === 0" class="text-center py-4">
                        <i class="ri-calendar-line display-4 text-muted"></i>
                        <h5 class="mt-3">Nessuna prenotazione trovata</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

